local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local anticheat = game.Workspace:FindFirstChild("DirtsAntiExploit")
if anticheat then
    anticheat:Destroy()
end

game.StarterGui:SetCore("ChatMakeSystemMessage", {
    Text = "Welcome to the game! Powered by sigma_script//t.me. Commands: !statK, !DeleteK, !HideK, !unhideK";
    Color = Color3.fromRGB(255, 255, 255);
    Font = Enum.Font.SourceSansBold;
    FontSize = Enum.FontSize.Size18;
})

local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TitleLabel = Instance.new("TextLabel")
local StartButton = Instance.new("TextButton")
local PlayerListButton = Instance.new("TextButton")
local PlayersFrame = Instance.new("ScrollingFrame")
local ClosePlayersButton = Instance.new("TextButton")
local PlayersList = {}
local selectedPlayers = {}
local maxSelection = 3

ScreenGui.Parent = playerGui

Frame.Parent = ScreenGui
Frame.Size = UDim2.new(0, 200, 0, 150)
Frame.Position = UDim2.new(0.5, -100, 0.5, -75)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BackgroundTransparency = 0.2
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 10)
frameCorner.Parent = Frame

TitleLabel.Parent = Frame
TitleLabel.Text = "sigma_script//t.me"
TitleLabel.Size = UDim2.new(1, 0, 0, 20)
TitleLabel.Position = UDim2.new(0, 0, 0, 10)
TitleLabel.BackgroundTransparency = 1
TitleLabel.TextScaled = true
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)

StartButton.Parent = Frame
StartButton.Text = "Start"
StartButton.Size = UDim2.new(1, -20, 0, 30)
StartButton.Position = UDim2.new(0, 10, 0, 90)
StartButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
StartButton.BorderSizePixel = 0
StartButton.TextScaled = true
StartButton.Font = Enum.Font.SourceSansBold
StartButton.TextColor3 = Color3.fromRGB(255, 255, 255)

PlayerListButton.Parent = Frame
PlayerListButton.Text = "Player List"
PlayerListButton.Size = UDim2.new(1, -20, 0, 30)
PlayerListButton.Position = UDim2.new(0, 10, 0, 50)
PlayerListButton.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
PlayerListButton.BorderSizePixel = 0
PlayerListButton.TextScaled = true
PlayerListButton.Font = Enum.Font.SourceSansBold
PlayerListButton.TextColor3 = Color3.fromRGB(255, 255, 255)

PlayersFrame.Parent = ScreenGui
PlayersFrame.Size = UDim2.new(0, 200, 0, 400)
PlayersFrame.Position = UDim2.new(0.5, -100, 0.55, -200)
PlayersFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
PlayersFrame.BorderSizePixel = 0
PlayersFrame.Visible = false
PlayersFrame.CanvasSize = UDim2.new(0, 0, 0, 420)
PlayersFrame.ScrollBarThickness = 6

local playersFrameCorner = Instance.new("UICorner")
playersFrameCorner.CornerRadius = UDim.new(0, 10)
playersFrameCorner.Parent = PlayersFrame

ClosePlayersButton.Parent = PlayersFrame
ClosePlayersButton.Text = "Close"
ClosePlayersButton.Size = UDim2.new(1, -20, 0, 30)
ClosePlayersButton.Position = UDim2.new(0, 10, 0, 10)
ClosePlayersButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ClosePlayersButton.BorderSizePixel = 0
ClosePlayersButton.TextScaled = true
ClosePlayersButton.Font = Enum.Font.SourceSansBold
ClosePlayersButton.TextColor3 = Color3.fromRGB(255, 255, 255)

local function deleteHumanoidRootPart(targetPlayer)
    local character = targetPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        character.HumanoidRootPart:Destroy()

        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.PlatformStand = true
        end

        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.Anchored = true
                part.CFrame = player.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -5)
            end
        end
    end
end

local function updatePlayersList()
    for _, gui in pairs(PlayersList) do
        gui:Destroy()
    end
    PlayersList = {}
    
    local yOffset = 50
    for _, targetPlayer in pairs(game.Players:GetPlayers()) do
        if targetPlayer ~= player then
            local playerFrame = Instance.new("Frame")
            playerFrame.Size = UDim2.new(1, 0, 0, 30)
            playerFrame.Position = UDim2.new(0, 0, 0, yOffset)
            playerFrame.BackgroundTransparency = 1
            playerFrame.Parent = PlayersFrame

            local playerLabel = Instance.new("TextLabel")
            playerLabel.Size = UDim2.new(0.8, 0, 1, 0)
            playerLabel.Position = UDim2.new(0, 0, 0, 0)
            playerLabel.BackgroundTransparency = 1
            playerLabel.Text = targetPlayer.Name
            playerLabel.TextScaled = true
            playerLabel.Font = Enum.Font.SourceSans
            playerLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            playerLabel.Parent = playerFrame

            local checkbox = Instance.new("TextButton")
            checkbox.Size = UDim2.new(0.2, 0, 1, 0)
            checkbox.Position = UDim2.new(0.8, 0, 0, 0)
            checkbox.BackgroundColor3 = selectedPlayers[targetPlayer.Name] and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
            checkbox.Text = ""
            checkbox.Parent = playerFrame

            local isSelected = selectedPlayers[targetPlayer.Name] or false

            checkbox.MouseButton1Click:Connect(function()
                if isSelected then
                    isSelected = false
                    selectedPlayers[targetPlayer.Name] = nil
                    checkbox.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                elseif table.getn(selectedPlayers) < maxSelection then
                    isSelected = true
                    selectedPlayers[targetPlayer.Name] = true
                    checkbox.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
                end
            end)

            yOffset = yOffset + 35
            table.insert(PlayersList, playerFrame)
        end
    end
end

StartButton.MouseButton1Click:Connect(function()
    for playerName, _ in pairs(selectedPlayers) do
        local targetPlayer = game.Players:FindFirstChild(playerName)
        if targetPlayer then
            deleteHumanoidRootPart(targetPlayer)
        end
    end
end)

PlayerListButton.MouseButton1Click:Connect(function()
    PlayersFrame.Visible = true
    updatePlayersList()
end)

ClosePlayersButton.MouseButton1Click:Connect(function()
    PlayersFrame.Visible = false
end)

updatePlayersList()

game.Players.PlayerAdded:Connect(function(newPlayer)
    updatePlayersList()
end)

game.Players.PlayerRemoving:Connect(function(leavingPlayer)
    selectedPlayers[leavingPlayer.Name] = nil
    updatePlayersList()
end)

player.Chatted:Connect(function(msg)
    local cmd = msg:lower()
    if cmd == "!statk" then
        Frame.Position = UDim2.new(0.5, -100, 0.5, -75)
    elseif cmd == "!deletek" then
        ScreenGui:Destroy()
    elseif cmd == "!hidek" then
        Frame.Visible = false
    elseif cmd == "!unhidek" then
        Frame.Visible = true
    end
end)

